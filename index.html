<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandarin Mate å‹è¯­ - ä½ çš„AIä¸­æ–‡ä¼™ä¼´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Noto Sans SC', 'sans-serif'],
                        serif: ['Noto Serif SC', 'serif'],
                    },
                    colors: {
                        'ink': '#1a1a1a',
                        'paper': '#f7f5f0',
                        'cinnabar': '#c41e3a',
                        'bamboo': '#5a7c5a',
                        'gold': '#d4af37',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'wave': 'wave 2s linear infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        wave: {
                            '0%': { transform: 'scaleY(1)' },
                            '50%': { transform: 'scaleY(0.5)' },
                            '100%': { transform: 'scaleY(1)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .ink-wash {
            background: linear-gradient(135deg, #f7f5f0 0%, #e8e6e1 100%);
        }
        .chat-bubble-left {
            border-radius: 20px 20px 20px 5px;
        }
        .chat-bubble-right {
            border-radius: 20px 20px 5px 20px;
        }
        .character-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .character-card:hover {
            transform: translateY(-10px);
        }
        .recording-pulse {
            animation: recording-pulse 1.5s ease-in-out infinite;
        }
        @keyframes recording-pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(196, 30, 58, 0.7); }
            50% { box-shadow: 0 0 0 20px rgba(196, 30, 58, 0); }
        }
        .ink-brush {
            position: relative;
            overflow: hidden;
        }
        .ink-brush::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #1a1a1a, transparent);
            opacity: 0.3;
        }
        .scroll-hide::-webkit-scrollbar {
            display: none;
        }
        .scroll-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-paper text-ink font-sans overflow-x-hidden">

    <!-- Navigation -->
    <nav class="fixed w-full z-50 glass-panel border-b border-stone-200 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3 cursor-pointer" onclick="switchMode('home')">
                    <div class="w-10 h-10 bg-cinnabar rounded-full flex items-center justify-center text-white font-bold text-xl shadow-lg">
                        å‹
                    </div>
                    <div>
                        <h1 class="text-xl font-bold tracking-tight">Mandarin Mate</h1>
                        <p class="text-xs text-stone-500">å‹è¯­</p>
                    </div>
                </div>
                <div class="hidden md:flex space-x-8">
                    <button onclick="switchMode('home')" class="nav-btn text-stone-600 hover:text-cinnabar transition-colors font-medium">é¦–é¡µ</button>
                    <button onclick="switchMode('chat')" class="nav-btn text-stone-600 hover:text-cinnabar transition-colors font-medium">æ²‰æµ¸å¯¹è¯</button>
                    <button onclick="switchMode('explore')" class="nav-btn text-stone-600 hover:text-cinnabar transition-colors font-medium">å›¾æ–‡æ¢ç´¢</button>
                    <button onclick="switchMode('about')" class="nav-btn text-stone-600 hover:text-cinnabar transition-colors font-medium">å…³äºæˆ‘ä»¬</button>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="md:hidden" onclick="toggleMobileMenu()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                    </button>
                    <div class="hidden md:flex items-center space-x-2 text-sm text-stone-500">
                        <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span>
                        <span>åœ¨çº¿ç”¨æˆ·: <span id="online-count">1,247</span></span>
                    </div>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden glass-panel border-t">
            <div class="px-4 pt-2 pb-4 space-y-2">
                <button onclick="switchMode('home')" class="block w-full text-left py-2 text-stone-600">é¦–é¡µ</button>
                <button onclick="switchMode('chat')" class="block w-full text-left py-2 text-stone-600">æ²‰æµ¸å¯¹è¯</button>
                <button onclick="switchMode('explore')" class="block w-full text-left py-2 text-stone-600">å›¾æ–‡æ¢ç´¢</button>
                <button onclick="switchMode('about')" class="block w-full text-left py-2 text-stone-600">å…³äºæˆ‘ä»¬</button>
            </div>
        </div>
    </nav>

    <!-- Home / Hero Section -->
    <section id="home-section" class="min-h-screen pt-16 relative overflow-hidden">
        <!-- Background Elements -->
        <div class="absolute inset-0 z-0">
            <div class="absolute top-20 left-10 w-64 h-64 bg-stone-200 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float"></div>
            <div class="absolute bottom-20 right-10 w-96 h-96 bg-cinnabar/10 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-float" style="animation-delay: 2s;"></div>
            <svg class="absolute bottom-0 left-0 w-full h-64 opacity-5" viewBox="0 0 1440 320" preserveAspectRatio="none">
                <path fill="#1a1a1a" d="M0,192L48,197.3C96,203,192,213,288,229.3C384,245,480,267,576,250.7C672,235,768,181,864,181.3C960,181,1056,235,1152,234.7C1248,235,1344,181,1392,154.7L1440,128L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
        </div>

        <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-20 pb-32">
            <div class="text-center space-y-8">
                <div class="inline-block animate-float">
                    <span class="px-4 py-2 rounded-full bg-white/80 border border-stone-200 text-sm text-stone-600 shadow-sm">
                        ğŸ‰ å®Œå…¨å…è´¹ Â· æ— éœ€æ³¨å†Œ Â· AIé©±åŠ¨
                    </span>
                </div>
                <h1 class="text-5xl md:text-7xl font-bold tracking-tight text-ink font-serif">
                    Your AI Friend for<br>
                    <span class="text-cinnabar relative inline-block">
                        Fluent Mandarin
                        <svg class="absolute -bottom-2 left-0 w-full h-3 text-cinnabar/20" viewBox="0 0 200 9" fill="none"><path d="M2.00025 6.99997C25.7501 2.99999 83.2344 2.19042 142.5 2.99999C170.688 3.44274 191.5 4.00001 198 6.99997" stroke="currentColor" stroke-width="3"/></svg>
                    </span>
                </h1>
                <p class="text-xl text-stone-600 max-w-2xl mx-auto leading-relaxed">
                    éšæ—¶éšåœ°ï¼Œä¸AIä¼™ä¼´ç»ƒä¹ åœ°é“ä¸­æ–‡ã€‚ä»é›¶åŸºç¡€åˆ°å•†åŠ¡æµåˆ©ï¼Œ<br class="hidden md:block">é›¶å‹åŠ›ã€å…¨å…è´¹ã€æ²‰æµ¸å¼å­¦ä¹ ä½“éªŒã€‚
                </p>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center pt-8">
                    <button onclick="startQuickChat()" class="group relative px-8 py-4 bg-cinnabar text-white rounded-full font-semibold text-lg shadow-xl hover:shadow-2xl hover:scale-105 transition-all overflow-hidden">
                        <span class="relative z-10 flex items-center justify-center gap-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                            å¼€å§‹å¯¹è¯
                        </span>
                        <div class="absolute inset-0 bg-gradient-to-r from-cinnabar to-red-600 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    </button>
                    <button onclick="switchMode('explore')" class="px-8 py-4 bg-white text-ink border-2 border-stone-200 rounded-full font-semibold text-lg hover:border-cinnabar hover:text-cinnabar transition-all">
                        æµè§ˆå­¦ä¹ èµ„æ–™
                    </button>
                </div>

                <!-- Stats -->
                <div class="grid grid-cols-3 gap-8 max-w-2xl mx-auto pt-12 text-center">
                    <div>
                        <div class="text-3xl font-bold text-ink">50K+</div>
                        <div class="text-sm text-stone-500">å­¦ä¹ è€…</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-ink">4</div>
                        <div class="text-sm text-stone-500">AIè§’è‰²</div>
                    </div>
                    <div>
                        <div class="text-3xl font-bold text-ink">100%</div>
                        <div class="text-sm text-stone-500">å…è´¹</div>
                    </div>
                </div>
            </div>

            <!-- Character Preview Cards -->
            <div class="mt-24 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Li Xiao -->
                <div class="character-card bg-white rounded-2xl p-6 shadow-lg border border-stone-100 cursor-pointer group" onclick="selectCharacter('lixiao')">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-blue-100 to-blue-50 flex items-center justify-center text-4xl shadow-inner group-hover:scale-110 transition-transform">
                        ğŸ‘¨â€ğŸ«
                    </div>
                    <h3 class="text-lg font-bold text-center mb-1">ææ™“ Li Xiao</h3>
                    <p class="text-xs text-cinnabar text-center mb-3">è€å¿ƒç§æ•™</p>
                    <p class="text-sm text-stone-600 text-center">æ¸©æŸ”è€å¿ƒï¼Œå‘éŸ³æ ‡å‡†ï¼Œé€‚åˆåˆå­¦è€…</p>
                    <div class="mt-4 flex justify-center gap-2">
                        <span class="px-2 py-1 bg-stone-100 rounded text-xs">HSK 1-3</span>
                        <span class="px-2 py-1 bg-stone-100 rounded text-xs">æ…¢é€Ÿ</span>
                    </div>
                </div>

                <!-- Qiang -->
                <div class="character-card bg-white rounded-2xl p-6 shadow-lg border border-stone-100 cursor-pointer group" onclick="selectCharacter('qiang')">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-orange-100 to-orange-50 flex items-center justify-center text-4xl shadow-inner group-hover:scale-110 transition-transform">
                        ğŸ§¢
                    </div>
                    <h3 class="text-lg font-bold text-center mb-1">é˜¿å¼º Qiang</h3>
                    <p class="text-xs text-cinnabar text-center mb-3">è¡—å¤´ä¹å¤©æ´¾</p>
                    <p class="text-sm text-stone-600 text-center">å¹½é»˜é£è¶£ï¼Œæµè¡Œè¯­è¾¾äººï¼Œåœ°é“å£è¯­</p>
                    <div class="mt-4 flex justify-center gap-2">
                        <span class="px-2 py-1 bg-stone-100 rounded text-xs">HSK 4-6</span>
                        <span class="px-2 py-1 bg-stone-100 rounded text-xs">å¿«é€Ÿ</span>
                    </div>
                </div>

                <!-- Ms. Wang -->
                <div class="character-card bg-white rounded-2xl p-6 shadow-lg border border-stone-100 cursor-pointer group" onclick="selectCharacter('wang')">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-purple-100 to-purple-50 flex items-center justify-center text-4xl shadow-inner group-hover:scale-110 transition-transform">
                        ğŸ‘©â€ğŸ’¼
                    </div>
                    <h3 class="text-lg font-bold text-center mb-1">ç‹æ€» Ms. Wang</h3>
                    <p class="text-xs text-cinnabar text-center mb-3">å•†åŠ¡ç²¾è‹±</p>
                    <p class="text-sm text-stone-600 text-center">ä¸“ä¸šæ­£å¼ï¼Œå•†åŠ¡è°ˆåˆ¤ä¸é¢è¯•æ¨¡æ‹Ÿ</p>
                    <div class="mt-4 flex justify-center gap-2">
                        <span class="px-2 py-1 bg-stone-100 rounded text-xs">å•†åŠ¡</span>
                        <span class="px-2 py-1 bg-stone-100 rounded text-xs">æ­£å¼</span>
                    </div>
                </div>

                <!-- Panda Gu -->
                <div class="character-card bg-white rounded-2xl p-6 shadow-lg border border-stone-100 cursor-pointer group" onclick="selectCharacter('panda')">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-green-100 to-green-50 flex items-center justify-center text-4xl shadow-inner group-hover:scale-110 transition-transform">
                        ğŸ¼
                    </div>
                    <h3 class="text-lg font-bold text-center mb-1">æ»šæ»š Panda Gu</h3>
                    <p class="text-xs text-cinnabar text-center mb-3">å„¿ç«¥ä¼™ä¼´</p>
                    <p class="text-sm text-stone-600 text-center">æ´»æ³¼å¯çˆ±ï¼Œå„¿æ­Œæ•…äº‹ï¼Œé›¶åŸºç¡€å‹å¥½</p>
                    <div class="mt-4 flex justify-center gap-2">
                        <span class="px-2 py-1 bg-stone-100 rounded text-xs">å„¿ç«¥</span>
                        <span class="px-2 py-1 bg-stone-100 rounded text-xs">è¶£å‘³</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Chat Interface Section -->
    <section id="chat-section" class="hidden min-h-screen pt-16 bg-stone-50">
        <div class="flex h-[calc(100vh-4rem)]">
            <!-- Sidebar -->
            <div class="w-80 bg-white border-r border-stone-200 flex flex-col hidden md:flex">
                <div class="p-6 border-b border-stone-100">
                    <h2 class="text-lg font-bold mb-4">é€‰æ‹©ä½ çš„è¯­ä¼´</h2>
                    <div class="space-y-3">
                        <div class="character-option p-3 rounded-xl bg-blue-50 border-2 border-blue-200 cursor-pointer transition-all" onclick="switchCharacter('lixiao')">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-2xl">ğŸ‘¨â€ğŸ«</div>
                                <div>
                                    <div class="font-semibold text-sm">ææ™“</div>
                                    <div class="text-xs text-stone-500">æ ‡å‡†æ™®é€šè¯å¯¼å¸ˆ</div>
                                </div>
                            </div>
                        </div>
                        <div class="character-option p-3 rounded-xl hover:bg-stone-50 border-2 border-transparent cursor-pointer transition-all" onclick="switchCharacter('qiang')">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-2xl">ğŸ§¢</div>
                                <div>
                                    <div class="font-semibold text-sm">é˜¿å¼º</div>
                                    <div class="text-xs text-stone-500">è¡—å¤´å£è¯­è¾¾äºº</div>
                                </div>
                            </div>
                        </div>
                        <div class="character-option p-3 rounded-xl hover:bg-stone-50 border-2 border-transparent cursor-pointer transition-all" onclick="switchCharacter('wang')">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center text-2xl">ğŸ‘©â€ğŸ’¼</div>
                                <div>
                                    <div class="font-semibold text-sm">ç‹æ€»</div>
                                    <div class="text-xs text-stone-500">å•†åŠ¡åœºæ™¯ä¸“å®¶</div>
                                </div>
                            </div>
                        </div>
                        <div class="character-option p-3 rounded-xl hover:bg-stone-50 border-2 border-transparent cursor-pointer transition-all" onclick="switchCharacter('panda')">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center text-2xl">ğŸ¼</div>
                                <div>
                                    <div class="font-semibold text-sm">æ»šæ»š</div>
                                    <div class="text-xs text-stone-500">å„¿ç«¥å­¦ä¹ ä¼™ä¼´</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="p-6 flex-1">
                    <h3 class="text-sm font-semibold text-stone-400 uppercase tracking-wider mb-4">å­¦ä¹ è®¾ç½®</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs text-stone-600 block mb-2">è¯­é€Ÿ Speed</label>
                            <input type="range" min="0.5" max="1.5" step="0.1" value="1" class="w-full accent-cinnabar" id="speed-control" onchange="updateSettings()">
                            <div class="flex justify-between text-xs text-stone-400 mt-1">
                                <span>æ…¢</span>
                                <span>æ ‡å‡†</span>
                                <span>å¿«</span>
                            </div>
                        </div>
                        <div>
                            <label class="text-xs text-stone-600 block mb-2">éš¾åº¦ HSK Level</label>
                            <select class="w-full p-2 rounded-lg border border-stone-200 text-sm bg-white" id="hsk-level" onchange="updateSettings()">
                                <option value="1">HSK 1 (åˆçº§)</option>
                                <option value="2">HSK 2</option>
                                <option value="3" selected>HSK 3 (ä¸­çº§)</option>
                                <option value="4">HSK 4</option>
                                <option value="5">HSK 5</option>
                                <option value="6">HSK 6 (é«˜çº§)</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <input type="checkbox" id="auto-correct" checked class="rounded text-cinnabar focus:ring-cinnabar">
                            <label for="auto-correct" class="text-sm text-stone-600">å®æ—¶çº é”™</label>
                        </div>
                    </div>
                </div>

                <div class="p-4 border-t border-stone-100 bg-stone-50">
                    <div class="text-xs text-stone-500 text-center">
                        ä»Šæ—¥ç»ƒä¹ æ—¶é•¿<br>
                        <span class="text-lg font-bold text-cinnabar" id="practice-time">00:00</span>
                    </div>
                </div>
            </div>

            <!-- Chat Area -->
            <div class="flex-1 flex flex-col bg-white">
                <!-- Chat Header -->
                <div class="h-16 border-b border-stone-100 flex items-center justify-between px-6 bg-white">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-xl" id="current-avatar">ğŸ‘¨â€ğŸ«</div>
                        <div>
                            <h3 class="font-semibold" id="current-character-name">ææ™“</h3>
                            <p class="text-xs text-green-600 flex items-center gap-1">
                                <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
                                åœ¨çº¿
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="toggleCorrectionPanel()" class="p-2 hover:bg-stone-100 rounded-full transition-colors" title="çº é”™é¢æ¿">
                            <svg class="w-5 h-5 text-stone-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </button>
                        <button onclick="endChat()" class="p-2 hover:bg-stone-100 rounded-full transition-colors text-stone-400 hover:text-red-500">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                </div>

                <!-- Messages -->
                <div class="flex-1 overflow-y-auto p-6 space-y-6 scroll-hide" id="chat-messages">
                    <div class="flex gap-4">
                        <div class="w-10 h-10 rounded-full bg-blue-100 flex-shrink-0 flex items-center justify-center text-xl">ğŸ‘¨â€ğŸ«</div>
                        <div class="max-w-[70%]">
                            <div class="chat-bubble-left bg-stone-100 p-4 text-stone-800">
                                ä½ å¥½ï¼æˆ‘æ˜¯ææ™“ï¼Œä½ çš„ä¸­æ–‡å­¦ä¹ ä¼™ä¼´ã€‚ä»Šå¤©æƒ³ç»ƒä¹ ä»€ä¹ˆè¯é¢˜å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥èŠèŠæ—¥å¸¸ç”Ÿæ´»ï¼Œæˆ–è€…ä½ æœ‰ç‰¹å®šçš„åœºæ™¯æƒ³æ¨¡æ‹Ÿå—ï¼Ÿ
                            </div>
                            <div class="mt-1 text-xs text-stone-400">åˆšåˆš</div>
                        </div>
                    </div>
                </div>

                <!-- Correction Panel (Collapsible) -->
                <div id="correction-panel" class="hidden bg-amber-50 border-t border-amber-100 p-4 max-h-48 overflow-y-auto">
                    <h4 class="text-sm font-semibold text-amber-800 mb-2 flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        å®æ—¶åé¦ˆ
                    </h4>
                    <div id="correction-content" class="space-y-2 text-sm">
                        <p class="text-stone-500 italic">å¼€å§‹å¯¹è¯åï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œä¸ºä½ çº æ­£å‘éŸ³å’Œè¯­æ³•é”™è¯¯...</p>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="border-t border-stone-100 p-4 bg-white">
                    <div class="max-w-4xl mx-auto">
                        <div class="flex items-end gap-2 bg-stone-50 rounded-2xl p-2 border border-stone-200 focus-within:border-cinnabar focus-within:ring-2 focus-within:ring-cinnabar/20 transition-all">
                            <button class="p-3 hover:bg-stone-200 rounded-xl transition-colors text-stone-600" onclick="toggleInputMode()" id="input-mode-btn">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path></svg>
                            </button>
                            
                            <div class="flex-1 relative">
                                <input type="text" id="text-input" class="w-full bg-transparent border-none focus:ring-0 py-3 px-2 text-stone-800 placeholder-stone-400" placeholder="è¾“å…¥æ¶ˆæ¯..." onkeypress="handleKeyPress(event)">
                                <div id="voice-input" class="hidden absolute inset-0 flex items-center justify-center bg-stone-50 cursor-pointer" onclick="toggleRecording()">
                                    <span class="text-stone-500 font-medium flex items-center gap-2">
                                        <span class="w-2 h-2 bg-cinnabar rounded-full animate-pulse"></span>
                                        æŒ‰ä½è¯´è¯ Hold to Speak
                                    </span>
                                </div>
                            </div>

                            <button onclick="sendMessage()" class="p-3 bg-cinnabar text-white rounded-xl hover:bg-red-700 transition-colors shadow-md">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
                            </button>
                        </div>
                        <div class="text-center mt-2 text-xs text-stone-400">
                            æŒ‰ Enter å‘é€ Â· AI å¯èƒ½ä¼šç”Ÿæˆä¸å‡†ç¡®çš„ä¿¡æ¯
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Explore Section -->
    <section id="explore-section" class="hidden min-h-screen pt-24 pb-12 bg-paper">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold mb-4">å›¾æ–‡æ¢ç´¢æ¨¡å¼</h2>
                <p class="text-stone-600">ç³»ç»Ÿæ€§å­¦ä¹ ï¼Œåœºæ™¯åŒ–è®°å¿†ï¼Œè®©ä¸­æ–‡å­¦ä¹ æ›´ç›´è§‚</p>
            </div>

            <!-- Category Tabs -->
            <div class="flex justify-center gap-4 mb-12 flex-wrap">
                <button onclick="switchExploreTab('scenes')" class="explore-tab px-6 py-2 rounded-full bg-cinnabar text-white font-medium transition-all" data-tab="scenes">æƒ…æ™¯å¯¹è¯</button>
                <button onclick="switchExploreTab('stories')" class="explore-tab px-6 py-2 rounded-full bg-white text-stone-600 border border-stone-200 hover:border-cinnabar transition-all" data-tab="stories">AIæ•…äº‹ä¼š</button>
                <button onclick="switchExploreTab('phrases')" class="explore-tab px-6 py-2 rounded-full bg-white text-stone-600 border border-stone-200 hover:border-cinnabar transition-all" data-tab="phrases">æ¯æ—¥ä¸€å¥</button>
                <button onclick="switchExploreTab('culture')" class="explore-tab px-6 py-2 rounded-full bg-white text-stone-600 border border-stone-200 hover:border-cinnabar transition-all" data-tab="culture">æ–‡åŒ–æ´å¯Ÿ</button>
            </div>

            <!-- Scenes Content -->
            <div id="explore-scenes" class="explore-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Scene Card 1 -->
                    <div class="group bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer" onclick="openScene('restaurant')">
                        <div class="h-48 bg-gradient-to-br from-orange-100 to-red-50 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                            ğŸœ
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">åœ¨é¤å… Ordering Food</h3>
                            <p class="text-stone-600 text-sm mb-4">å­¦ä¹ ç‚¹é¤ã€è¯¢é—®æ¨èã€æ”¯ä»˜ç­‰å®ç”¨å¯¹è¯</p>
                            <div class="flex gap-2">
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">HSK 2</span>
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">12 ä¸ªå¥å­</span>
                            </div>
                        </div>
                    </div>

                    <!-- Scene Card 2 -->
                    <div class="group bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer" onclick="openScene('airport')">
                        <div class="h-48 bg-gradient-to-br from-blue-100 to-sky-50 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                            âœˆï¸
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">åœ¨æœºåœº At the Airport</h3>
                            <p class="text-stone-600 text-sm mb-4">å€¼æœºã€å®‰æ£€ã€ç™»æœºã€è¡Œææå–å…¨æµç¨‹</p>
                            <div class="flex gap-2">
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">HSK 3</span>
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">15 ä¸ªå¥å­</span>
                            </div>
                        </div>
                    </div>

                    <!-- Scene Card 3 -->
                    <div class="group bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer" onclick="openScene('taxi')">
                        <div class="h-48 bg-gradient-to-br from-yellow-100 to-amber-50 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                            ğŸš•
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">æ‰“è½¦ Taking a Taxi</h3>
                            <p class="text-stone-600 text-sm mb-4">æŒ‡è·¯ã€è¯¢ä»·ã€ä¸å¸æœºé—²èŠå¸¸ç”¨è¯­</p>
                            <div class="flex gap-2">
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">HSK 2</span>
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">8 ä¸ªå¥å­</span>
                            </div>
                        </div>
                    </div>

                    <!-- Scene Card 4 -->
                    <div class="group bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer" onclick="openScene('hotel')">
                        <div class="h-48 bg-gradient-to-br from-purple-100 to-pink-50 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                            ğŸ¨
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">é…’åº—å…¥ä½ Hotel Check-in</h3>
                            <p class="text-stone-600 text-sm mb-4">é¢„è®¢ã€å…¥ä½ã€æŠ•è¯‰ã€é€€æˆ¿å®Œæ•´å¯¹è¯</p>
                            <div class="flex gap-2">
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">HSK 3</span>
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">10 ä¸ªå¥å­</span>
                            </div>
                        </div>
                    </div>

                    <!-- Scene Card 5 -->
                    <div class="group bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer" onclick="openScene('shopping')">
                        <div class="h-48 bg-gradient-to-br from-green-100 to-emerald-50 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                            ğŸ›ï¸
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">è´­ç‰© Shopping</h3>
                            <p class="text-stone-600 text-sm mb-4">è¯¢ä»·ã€ç ä»·ã€é€€æ¢è´§å®ç”¨è¡¨è¾¾</p>
                            <div class="flex gap-2">
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">HSK 2</span>
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">14 ä¸ªå¥å­</span>
                            </div>
                        </div>
                    </div>

                    <!-- Scene Card 6 -->
                    <div class="group bg-white rounded-2xl overflow-hidden shadow-md hover:shadow-xl transition-all cursor-pointer" onclick="openScene('hospital')">
                        <div class="h-48 bg-gradient-to-br from-red-100 to-rose-50 flex items-center justify-center text-6xl group-hover:scale-110 transition-transform duration-500">
                            ğŸ¥
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">çœ‹ç—… Seeing a Doctor</h3>
                            <p class="text-stone-600 text-sm mb-4">æŒ‚å·ã€æè¿°ç—‡çŠ¶ã€å–è¯åŒ»ç–—ç”¨è¯­</p>
                            <div class="flex gap-2">
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">HSK 4</span>
                                <span class="px-3 py-1 bg-stone-100 rounded-full text-xs">18 ä¸ªå¥å­</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stories Content -->
            <div id="explore-stories" class="explore-content hidden">
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="bg-white rounded-2xl p-8 shadow-md">
                        <div class="flex items-start gap-6">
                            <div class="w-24 h-24 rounded-full bg-amber-100 flex items-center justify-center text-4xl flex-shrink-0">
                                ğŸ‰
                            </div>
                            <div class="flex-1">
                                <h3 class="text-2xl font-bold mb-2">æˆè¯­æ•…äº‹ï¼šç”»é¾™ç‚¹ç›</h3>
                                <p class="text-stone-500 text-sm mb-4">HSK 4 Â· 5åˆ†é’Ÿé˜…è¯»</p>
                                <p class="text-stone-700 leading-relaxed mb-4">
                                    ä¼ è¯´å¤æ—¶å€™æœ‰ä¸ªç”»å®¶å«å¼ åƒ§ç¹‡ï¼Œä»–åœ¨å¯ºåº™çš„å¢™ä¸Šç”»äº†å››æ¡é¾™ï¼Œä½†éƒ½æ²¡æœ‰ç”»çœ¼ç›ã€‚äººä»¬é—®ä»–ä¸ºä»€ä¹ˆï¼Œä»–è¯´ï¼š"å¦‚æœç”»ä¸Šçœ¼ç›ï¼Œé¾™å°±ä¼šé£èµ°ã€‚"å¤§å®¶éƒ½ä¸ç›¸ä¿¡ï¼ŒåšæŒè¦ä»–ç”»ä¸Šã€‚å¼ åƒ§ç¹‡åªå¥½ç»™å…¶ä¸­ä¸¤æ¡é¾™ç‚¹ä¸Šäº†çœ¼ç›ã€‚åˆšç”»å®Œï¼Œé›·ç”µäº¤åŠ ï¼Œä¸¤æ¡é¾™ç ´å¢™è€Œå‡ºï¼Œé£ä¸Šäº†å¤©...
                                </p>
                                <button class="flex items-center gap-2 text-cinnabar font-medium hover:gap-3 transition-all" onclick="playStory('hua-long-dian-jing')">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    å¬æ•…äº‹ Listen
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-2xl p-8 shadow-md">
                        <div class="flex items-start gap-6">
                            <div class="w-24 h-24 rounded-full bg-blue-100 flex items-center justify-center text-4xl flex-shrink-0">
                                ğŸŒ™
                            </div>
                            <div class="flex-1">
                                <h3 class="text-2xl font-bold mb-2">ç°ä»£çŸ­æ–‡ï¼šä¸­ç§‹èŠ‚çš„æ€å¿µ</h3>
                                <p class="text-stone-500 text-sm mb-4">HSK 3 Â· 3åˆ†é’Ÿé˜…è¯»</p>
                                <p class="text-stone-700 leading-relaxed mb-4">
                                    ä¸­ç§‹èŠ‚æ˜¯ä¸­å›½ä¼ ç»Ÿçš„èŠ‚æ—¥ã€‚æ¯å¹´çš„å†œå†å…«æœˆåäº”ï¼Œæœˆäº®ç‰¹åˆ«åœ†ï¼Œç‰¹åˆ«äº®ã€‚è¿™ä¸€å¤©ï¼Œæ— è®ºäººä»¬èº«åœ¨ä½•å¤„ï¼Œéƒ½ä¼šæŠ¬å¤´çœ‹çœ‹æœˆäº®ï¼Œæ€å¿µè¿œæ–¹çš„äº²äºº...
                                </p>
                                <button class="flex items-center gap-2 text-cinnabar font-medium hover:gap-3 transition-all" onclick="playStory('zhong-qiu')">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    å¬æ•…äº‹ Listen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Phrases Content -->
            <div id="explore-phrases" class="explore-content hidden">
                <div class="max-w-3xl mx-auto">
                    <div class="bg-gradient-to-br from-cinnabar to-red-700 rounded-3xl p-8 text-white text-center shadow-2xl">
                        <div class="text-sm uppercase tracking-widest opacity-80 mb-4">æ¯æ—¥ä¸€å¥ Phrase of the Day</div>
                        <h3 class="text-4xl font-serif mb-4" id="daily-phrase">åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹</h3>
                        <p class="text-xl mb-2 opacity-90" id="daily-pinyin">QiÄn lÇ zhÄ« xÃ­ng, shÇ yÃº zÃº xiÃ </p>
                        <p class="text-lg opacity-80 mb-6" id="daily-meaning">A journey of a thousand miles begins with a single step.</p>
                        <button onclick="speakText('åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹')" class="bg-white/20 hover:bg-white/30 px-6 py-3 rounded-full backdrop-blur transition-all flex items-center gap-2 mx-auto">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                            æ’­æ”¾å‘éŸ³
                        </button>
                    </div>

                    <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white p-6 rounded-xl shadow-md text-center cursor-pointer hover:shadow-lg transition-all" onclick="speakText('ä½ å¥½')">
                            <div class="text-2xl mb-2">ä½ å¥½</div>
                            <div class="text-sm text-stone-500">NÇ hÇo</div>
                            <div class="text-xs text-stone-400 mt-1">Hello</div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-md text-center cursor-pointer hover:shadow-lg transition-all" onclick="speakText('è°¢è°¢')">
                            <div class="text-2xl mb-2">è°¢è°¢</div>
                            <div class="text-sm text-stone-500">XiÃ¨xie</div>
                            <div class="text-xs text-stone-400 mt-1">Thank you</div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-md text-center cursor-pointer hover:shadow-lg transition-all" onclick="speakText('å†è§')">
                            <div class="text-2xl mb-2">å†è§</div>
                            <div class="text-sm text-stone-500">ZÃ ijiÃ n</div>
                            <div class="text-xs text-stone-400 mt-1">Goodbye</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Culture Content -->
            <div id="explore-culture" class="explore-content hidden">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white rounded-2xl overflow-hidden shadow-md">
                        <div class="h-64 bg-stone-200 flex items-center justify-center text-6xl">
                            ğŸ«–
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">ä¸­å›½èŒ¶æ–‡åŒ–</h3>
                            <p class="text-stone-600 text-sm">äº†è§£èŒ¶çš„åˆ†ç±»ã€æ³¡èŒ¶ç¤¼ä»ªã€ä»¥åŠ"å“èŒ¶"èƒŒåçš„å“²å­¦æ€æƒ³ã€‚</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl overflow-hidden shadow-md">
                        <div class="h-64 bg-stone-200 flex items-center justify-center text-6xl">
                            ğŸ§§
                        </div>
                        <div class="p-6">
                            <h3 class="text-xl font-bold mb-2">ä¼ ç»ŸèŠ‚æ—¥ä¸ä¹ ä¿—</h3>
                            <p class="text-stone-600 text-sm">æ˜¥èŠ‚ã€æ¸…æ˜ã€ç«¯åˆã€ä¸­ç§‹ï¼Œæ¢ç´¢èŠ‚æ—¥èƒŒåçš„å†å²ä¸ modern åº†ç¥æ–¹å¼ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about-section" class="hidden min-h-screen pt-24 pb-12 bg-paper">
        <div class="max-w-4xl mx-auto px-4">
            <div class="bg-white rounded-3xl p-8 md:p-12 shadow-xl">
                <h2 class="text-3xl font-bold mb-6 text-center">å…³äº Mandarin Mate å‹è¯­</h2>
                <div class="prose prose-stone max-w-none">
                    <p class="text-lg text-stone-600 leading-relaxed mb-6">
                        Mandarin Mate æ˜¯ä¸€ä¸ªéè¥åˆ©æ€§çš„ä¸­æ–‡å­¦ä¹ å¹³å°ï¼Œè‡´åŠ›äºé€šè¿‡ AI æŠ€æœ¯æ¶ˆé™¤è¯­è¨€å­¦ä¹ çš„éšœç¢ã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œè¯­è¨€ä¸ä»…æ˜¯æ²Ÿé€šçš„å·¥å…·ï¼Œæ›´æ˜¯ç†è§£æ–‡åŒ–çš„æ¡¥æ¢ã€‚
                    </p>
                    
                    <h3 class="text-xl font-bold mt-8 mb-4">æˆ‘ä»¬çš„ä½¿å‘½</h3>
                    <ul class="space-y-3 text-stone-600">
                        <li class="flex items-start gap-3">
                            <span class="text-cinnabar text-xl">â€¢</span>
                            <span>è®©å…¨çƒä¸­æ–‡å­¦ä¹ è€…èƒ½å¤Ÿéšæ—¶éšåœ°è¿›è¡Œé«˜è´¨é‡çš„å£è¯­ç»ƒä¹ </span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="text-cinnabar text-xl">â€¢</span>
                            <span>æ¶ˆé™¤"å¼€å£éš¾"çš„å¿ƒç†éšœç¢ï¼Œåˆ›é€ é›¶å‹åŠ›çš„å­¦ä¹ ç¯å¢ƒ</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <span class="text-cinnabar text-xl">â€¢</span>
                            <span>é€šè¿‡æŠ€æœ¯é™ä½æ•™è‚²æˆæœ¬ï¼Œä¿ƒè¿›è·¨æ–‡åŒ–äº¤æµ</span>
                        </li>
                    </ul>

                    <h3 class="text-xl font-bold mt-8 mb-4">æ”¯æŒæˆ‘ä»¬</h3>
                    <p class="text-stone-600 mb-6">
                        è™½ç„¶å¹³å°å®Œå…¨å…è´¹è¿è¥ï¼Œä½†æœåŠ¡å™¨å’Œ AI API è°ƒç”¨ä¼šäº§ç”Ÿæˆæœ¬ã€‚å¦‚æœæ‚¨è§‰å¾—è¿™ä¸ªé¡¹ç›®æœ‰ä»·å€¼ï¼Œæ¬¢è¿é€šè¿‡"è¯· AI å–æ¯èŒ¶"è®¡åˆ’æ”¯æŒæˆ‘ä»¬ã€‚
                    </p>
                    
                    <div class="bg-stone-50 rounded-2xl p-6 text-center">
                        <div class="text-4xl mb-4">ğŸµ</div>
                        <h4 class="font-bold mb-2">Buy the AI a cup of tea</h4>
                        <p class="text-sm text-stone-500 mb-4">æ¯ä¸€æ¯èŒ¶éƒ½èƒ½æ”¯æŒæˆ‘ä»¬è¿è¡Œä¸€æ•´å¤©</p>
                        <button class="px-6 py-2 bg-cinnabar text-white rounded-full hover:bg-red-700 transition-colors">
                            æèµ æ”¯æŒ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Scene Modal -->
    <div id="scene-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeScene()"></div>
        <div class="absolute inset-x-4 top-20 bottom-20 md:inset-x-auto md:left-1/2 md:-translate-x-1/2 md:w-full md:max-w-2xl bg-white rounded-3xl shadow-2xl overflow-hidden flex flex-col">
            <div class="p-6 border-b border-stone-100 flex justify-between items-center bg-gradient-to-r from-cinnabar/5 to-transparent">
                <h3 class="text-xl font-bold" id="scene-title">åœ¨é¤å…</h3>
                <button onclick="closeScene()" class="p-2 hover:bg-stone-100 rounded-full">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="flex-1 overflow-y-auto p-6" id="scene-content">
                <!-- Dynamic content -->
            </div>
        </div>
    </div>

    <script>
        // State Management
        let currentMode = 'home';
        let currentCharacter = 'lixiao';
        let isRecording = false;
        let practiceTime = 0;
        let practiceTimer = null;
        let messageHistory = [];

        // Character Configurations
        const characters = {
            lixiao: {
                name: 'ææ™“',
                avatar: 'ğŸ‘¨â€ğŸ«',
                bg: 'bg-blue-100',
                personality: 'patient',
                greeting: 'ä½ å¥½ï¼æˆ‘æ˜¯ææ™“ï¼Œä½ çš„ä¸­æ–‡å­¦ä¹ ä¼™ä¼´ã€‚ä»Šå¤©æƒ³ç»ƒä¹ ä»€ä¹ˆè¯é¢˜å‘¢ï¼Ÿ',
                style: 'æ¸©æŸ”è€å¿ƒï¼Œä¼šè¯¦ç»†è§£é‡Šè¯­æ³•å’Œå‘éŸ³'
            },
            qiang: {
                name: 'é˜¿å¼º',
                avatar: 'ğŸ§¢',
                bg: 'bg-orange-100',
                personality: 'casual',
                greeting: 'å˜¿ï¼å…„å¼Ÿ/å§å¦¹ï¼Œæ¥å•¦ï¼Ÿä»Šå¤©å’±ä»¬èŠç‚¹å•¥ï¼Ÿæœ€è¿‘æœ‰æ²¡æœ‰çœ‹å•¥å¥½ç©çš„ï¼Ÿ',
                style: 'å¹½é»˜é£è¶£ï¼Œå–œæ¬¢ç”¨ç½‘ç»œæµè¡Œè¯­'
            },
            wang: {
                name: 'ç‹æ€»',
                avatar: 'ğŸ‘©â€ğŸ’¼',
                bg: 'bg-purple-100',
                personality: 'professional',
                greeting: 'æ‚¨å¥½ï¼Œæˆ‘æ˜¯ç‹æ€»ã€‚å¾ˆé«˜å…´ä¸ºæ‚¨è¿›è¡Œå•†åŠ¡ä¸­æ–‡çš„è¾…å¯¼ã€‚æˆ‘ä»¬ä»Šå¤©æ¨¡æ‹Ÿå“ªä¸ªåœºæ™¯ï¼Ÿ',
                style: 'ä¸“ä¸šæ­£å¼ï¼Œæ³¨é‡å•†åŠ¡ç¤¼ä»ª'
            },
            panda: {
                name: 'æ»šæ»š',
                avatar: 'ğŸ¼',
                bg: 'bg-green-100',
                personality: 'playful',
                greeting: 'å—¨ï¼æˆ‘æ˜¯æ»šæ»šï½ä»Šå¤©æˆ‘ä»¬è¦ä¸€èµ·å­¦ä¸­æ–‡å—ï¼Ÿæˆ‘ä¼šå”±å„¿æ­Œå“¦ï¼',
                style: 'æ´»æ³¼å¯çˆ±ï¼Œé€‚åˆå„¿ç«¥å’Œåˆå­¦è€…'
            }
        };

        // Scene Data
        const sceneData = {
            restaurant: {
                title: 'åœ¨é¤å… Ordering Food',
                phrases: [
                    { cn: 'æˆ‘è¦é¢„è®¢ä¸€å¼ ä¸¤ä¸ªäººçš„æ¡Œå­ã€‚', py: 'WÇ’ yÃ o yÃ¹dÃ¬ng yÄ« zhÄng liÇng gÃ¨ rÃ©n de zhuÅzi.', en: 'I\'d like to reserve a table for two.' },
                    { cn: 'è¯·ç»™æˆ‘èœå•ã€‚', py: 'QÇng gÄ›i wÇ’ cÃ idÄn.', en: 'Please give me the menu.' },
                    { cn: 'è¿™ä¸ªè¾£ä¸è¾£ï¼Ÿ', py: 'ZhÃ¨ge lÃ  bÃ¹ lÃ ?', en: 'Is this spicy?' },
                    { cn: 'æˆ‘å¯¹èŠ±ç”Ÿè¿‡æ•ã€‚', py: 'WÇ’ duÃ¬ huÄshÄ“ng guÃ²mÇn.', en: 'I\'m allergic to peanuts.' },
                    { cn: 'è¯·ç»“è´¦ã€‚', py: 'QÇng jiÃ©zhÃ ng.', en: 'Check, please.' }
                ]
            },
            airport: {
                title: 'åœ¨æœºåœº At the Airport',
                phrases: [
                    { cn: 'æˆ‘çš„èˆªç­å·æ˜¯å¤šå°‘ï¼Ÿ', py: 'WÇ’ de hÃ¡ngbÄn hÃ o shÃ¬ duÅshao?', en: 'What is my flight number?' },
                    { cn: 'åœ¨å“ªé‡ŒåŠç†ç™»æœºæ‰‹ç»­ï¼Ÿ', py: 'ZÃ i nÇlÇ bÃ nlÇ dÄ“ngjÄ« shÇ’uxÃ¹?', en: 'Where can I check in?' },
                    { cn: 'æˆ‘çš„è¡Œæè¶…é‡äº†å—ï¼Ÿ', py: 'WÇ’ de xÃ­ngli chÄozhÃ²ng le ma?', en: 'Is my luggage overweight?' },
                    { cn: 'ç™»æœºå£åœ¨å“ªé‡Œï¼Ÿ', py: 'DÄ“ngjÄ« kÇ’u zÃ i nÇlÇ?', en: 'Where is the boarding gate?' }
                ]
            },
            taxi: {
                title: 'æ‰“è½¦ Taking a Taxi',
                phrases: [
                    { cn: 'è¯·å¸¦æˆ‘å»ç«è½¦ç«™ã€‚', py: 'QÇng dÃ i wÇ’ qÃ¹ huÇ’chÄ“zhÃ n.', en: 'Please take me to the train station.' },
                    { cn: 'æ‰“è¡¨å—ï¼Ÿ', py: 'DÇ biÇo ma?', en: 'Do you use the meter?' },
                    { cn: 'è¯·å¼€æ…¢ä¸€ç‚¹å„¿ã€‚', py: 'QÇng kÄi mÃ n yÄ«diÇnr.', en: 'Please drive a bit slower.' },
                    { cn: 'å°±åœ¨è¿™é‡Œåœå§ã€‚', py: 'JiÃ¹ zÃ i zhÃ¨lÇ tÃ­ng ba.', en: 'Please stop here.' }
                ]
            },
            hotel: {
                title: 'é…’åº—å…¥ä½ Hotel Check-in',
                phrases: [
                    { cn: 'æˆ‘æœ‰é¢„è®¢ã€‚', py: 'WÇ’ yÇ’u yÃ¹dÃ¬ng.', en: 'I have a reservation.' },
                    { cn: 'æˆ‘æƒ³åŠç†å…¥ä½ã€‚', py: 'WÇ’ xiÇng bÃ nlÇ rÃ¹zhÃ¹.', en: 'I\'d like to check in.' },
                    { cn: 'æˆ¿é—´æœ‰Wi-Fiå—ï¼Ÿ', py: 'FÃ¡ngjiÄn yÇ’u Wi-Fi ma?', en: 'Is there Wi-Fi in the room?' },
                    { cn: 'æ˜å¤©å‡ ç‚¹é€€æˆ¿ï¼Ÿ', py: 'MÃ­ngtiÄn jÇ diÇn tuÃ¬fÃ¡ng?', en: 'What time is check-out tomorrow?' }
                ]
            },
            shopping: {
                title: 'è´­ç‰© Shopping',
                phrases: [
                    { cn: 'æˆ‘åªæ˜¯çœ‹çœ‹ã€‚', py: 'WÇ’ zhÇshÃ¬ kÃ nkan.', en: 'I\'m just looking.' },
                    { cn: 'å¯ä»¥è¯•ç©¿å—ï¼Ÿ', py: 'KÄ›yÇ shÃ¬chuÄn ma?', en: 'Can I try this on?' },
                    { cn: 'å¤ªè´µäº†ï¼Œèƒ½ä¾¿å®œç‚¹å„¿å—ï¼Ÿ', py: 'TÃ i guÃ¬ le, nÃ©ng piÃ¡nyi yÄ«diÇnr ma?', en: 'It\'s too expensive. Can you make it cheaper?' },
                    { cn: 'æˆ‘å¯ä»¥ç”¨ä¿¡ç”¨å¡å—ï¼Ÿ', py: 'WÇ’ kÄ›yÇ yÃ²ng xÃ¬nyÃ²ngkÇ ma?', en: 'Can I pay by credit card?' }
                ]
            },
            hospital: {
                title: 'çœ‹ç—… Seeing a Doctor',
                phrases: [
                    { cn: 'æˆ‘å¤´ç–¼/èƒƒç–¼ã€‚', py: 'WÇ’ tÃ³utÃ©ng/wÃ¨itÃ©ng.', en: 'I have a headache/stomachache.' },
                    { cn: 'æˆ‘å‘çƒ§äº†ã€‚', py: 'WÇ’ fÄshÄo le.', en: 'I have a fever.' },
                    { cn: 'æˆ‘å¯¹é’éœ‰ç´ è¿‡æ•ã€‚', py: 'WÇ’ duÃ¬ qÄ«ngmÃ©isÃ¹ guÃ²mÇn.', en: 'I\'m allergic to penicillin.' },
                    { cn: 'éœ€è¦æ‰“é’ˆå—ï¼Ÿ', py: 'XÅ«yÃ o dÇzhÄ“n ma?', en: 'Do I need an injection?' }
                ]
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateOnlineCount();
            setInterval(updateOnlineCount, 30000);
            loadDailyPhrase();
        });

        // Navigation
        function switchMode(mode) {
            // Hide all sections
            document.getElementById('home-section').classList.add('hidden');
            document.getElementById('chat-section').classList.add('hidden');
            document.getElementById('explore-section').classList.add('hidden');
            document.getElementById('about-section').classList.add('hidden');
            
            // Show selected
            document.getElementById(mode + '-section').classList.remove('hidden');
            currentMode = mode;
            
            // Update nav active state
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-cinnabar');
                btn.classList.add('text-stone-600');
            });
            
            // Close mobile menu
            document.getElementById('mobile-menu').classList.add('hidden');
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Start practice timer if entering chat
            if (mode === 'chat' && !practiceTimer) {
                startPracticeTimer();
            } else if (mode !== 'chat' && practiceTimer) {
                stopPracticeTimer();
            }
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        // Character Selection
        function selectCharacter(charId) {
            currentCharacter = charId;
            const char = characters[charId];
            
            // Update UI
            document.getElementById('current-avatar').textContent = char.avatar;
            document.getElementById('current-avatar').className = `w-10 h-10 rounded-full ${char.bg} flex items-center justify-center text-xl`;
            document.getElementById('current-character-name').textContent = char.name;
            
            // Update sidebar selection
            document.querySelectorAll('.character-option').forEach(opt => {
                opt.classList.remove('bg-blue-50', 'border-blue-200', 'border-2');
                opt.classList.add('border-transparent', 'hover:bg-stone-50');
            });
            event.currentTarget.classList.remove('border-transparent', 'hover:bg-stone-50');
            event.currentTarget.classList.add('bg-blue-50', 'border-blue-200', 'border-2');
            
            switchMode('chat');
            resetChat();
        }

        function switchCharacter(charId) {
            currentCharacter = charId;
            const char = characters[charId];
            document.getElementById('current-avatar').textContent = char.avatar;
            document.getElementById('current-avatar').className = `w-10 h-10 rounded-full ${char.bg} flex items-center justify-center text-xl`;
            document.getElementById('current-character-name').textContent = char.name;
            resetChat();
        }

        function startQuickChat() {
            switchMode('chat');
            resetChat();
        }

        // Chat Functions
        function resetChat() {
            const char = characters[currentCharacter];
            const messagesDiv = document.getElementById('chat-messages');
            messagesDiv.innerHTML = `
                <div class="flex gap-4">
                    <div class="w-10 h-10 rounded-full ${char.bg} flex-shrink-0 flex items-center justify-center text-xl">${char.avatar}</div>
                    <div class="max-w-[70%]">
                        <div class="chat-bubble-left bg-stone-100 p-4 text-stone-800">
                            ${char.greeting}
                        </div>
                        <div class="mt-1 text-xs text-stone-400">åˆšåˆš</div>
                    </div>
                </div>
            `;
            messageHistory = [];
        }

        function sendMessage() {
            const input = document.getElementById('text-input');
            const text = input.value.trim();
            if (!text) return;
            
            addMessage(text, 'user');
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                generateAIResponse(text);
            }, 1000);
        }

        function addMessage(text, sender) {
            const messagesDiv = document.getElementById('chat-messages');
            const char = characters[currentCharacter];
            
            if (sender === 'user') {
                messagesDiv.innerHTML += `
                    <div class="flex gap-4 justify-end">
                        <div class="max-w-[70%]">
                            <div class="chat-bubble-right bg-cinnabar text-white p-4">
                                ${text}
                            </div>
                            <div class="mt-1 text-xs text-stone-400 text-right">åˆšåˆš</div>
                        </div>
                        <div class="w-10 h-10 rounded-full bg-stone-200 flex-shrink-0 flex items-center justify-center text-xl">ğŸ‘¤</div>
                    </div>
                `;
                
                // Add correction feedback
                if (document.getElementById('auto-correct').checked) {
                    addCorrectionFeedback(text);
                }
            } else {
                messagesDiv.innerHTML += `
                    <div class="flex gap-4">
                        <div class="w-10 h-10 rounded-full ${char.bg} flex-shrink-0 flex items-center justify-center text-xl">${char.avatar}</div>
                        <div class="max-w-[70%]">
                            <div class="chat-bubble-left bg-stone-100 p-4 text-stone-800">
                                ${text}
                            </div>
                            <div class="mt-1 text-xs text-stone-400">åˆšåˆš</div>
                        </div>
                    </div>
                `;
            }
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function generateAIResponse(userText) {
            const char = characters[currentCharacter];
            let response = '';
            
            // Simple response logic based on character personality
            if (char.personality === 'patient') {
                if (userText.includes('ä½ å¥½') || userText.includes('æ‚¨å¥½')) {
                    response = 'ä½ å¥½ï¼å¾ˆé«˜å…´è§åˆ°ä½ ã€‚æˆ‘ä»¬ä»Šå¤©å¯ä»¥ç»ƒä¹ æ—¥å¸¸å¯¹è¯ï¼Œæˆ–è€…ä½ æœ‰ç‰¹å®šçš„è¯­æ³•é—®é¢˜æƒ³é—®å—ï¼Ÿ';
                } else if (userText.includes('åƒ') || userText.includes('å–')) {
                    response = 'å¾ˆå¥½ï¼"åƒ"å’Œ"å–"æ˜¯å¸¸ç”¨çš„åŠ¨è¯ã€‚æ³¨æ„ï¼š"åƒé¥­"å¯ä»¥è¯´"chÄ« fÃ n"ï¼Œä½†æ˜¯"å–æ°´"è¦è¯´"hÄ“ shuÇ"ã€‚ä½ æƒ³ç»ƒä¹ æ›´å¤šå…³äºé¥®é£Ÿçš„è¯æ±‡å—ï¼Ÿ';
                } else {
                    response = 'è¯´å¾—ä¸é”™ï¼è®°ä½ï¼Œä¸­æ–‡çš„è¯­åºæ˜¯ä¸»è¯­+è°“è¯­+å®¾è¯­ã€‚ä½ å¯ä»¥è¯•ç€ç”¨æ›´å¤æ‚çš„å¥å­è¡¨è¾¾è¿™ä¸ªæƒ³æ³•ã€‚æ¯”å¦‚åŠ å…¥æ—¶é—´è¯"æ˜¨å¤©"ã€"ä»Šå¤©"ç­‰ã€‚';
                }
            } else if (char.personality === 'casual') {
                response = 'å“ˆå“ˆï¼Œå¯ä»¥å•Šï¼ä½ è¿™ä¸­æ–‡è¯´å¾—æŒºæºœçš„å˜›ã€‚ä¸è¿‡å’±ä»¬å¹³æ—¶è¯´è¯ä¼šæ›´éšæ„ä¸€ç‚¹ï¼Œæ¯”å¦‚å¯ä»¥è¯´"è¿˜è¡Œ"è€Œä¸æ˜¯"è¿˜å¯ä»¥"ã€‚è¦ä¸è¦æˆ‘æ•™ä½ ä¸€äº›ç½‘ç»œæµè¡Œè¯­ï¼Ÿ';
            } else if (char.personality === 'professional') {
                response = 'æ”¶åˆ°ã€‚åœ¨å•†åŠ¡åœºåˆï¼Œå»ºè®®æ‚¨ä½¿ç”¨æ›´æ­£å¼çš„è¡¨è¾¾æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨"è¯·é—®"ä»£æ›¿"ä¸çŸ¥é“"ï¼Œç”¨"è´µå…¬å¸"å°Šç§°å¯¹æ–¹ä¼ä¸šã€‚éœ€è¦æˆ‘æ¨¡æ‹Ÿä¸€ä¸ªå•†åŠ¡è°ˆåˆ¤åœºæ™¯å—ï¼Ÿ';
            } else {
                response = 'å“‡ï¼ä½ è¯´å¾—å¤ªæ£’å•¦ï¼ğŸ‰ æˆ‘ç»™ä½ é¼“æŒï¼è¦ä¸è¦è·Ÿæˆ‘ä¸€èµ·å”±é¦–å„¿æ­Œï¼Ÿæˆ–è€…æˆ‘ç»™ä½ è®²ä¸ªå°æ•…äº‹ï¼Ÿ';
            }
            
            addMessage(response, 'ai');
            
            // Text to speech
            if ('speechSynthesis' in window) {
                speakText(response);
            }
        }

        function addCorrectionFeedback(text) {
            const panel = document.getElementById('correction-content');
            const corrections = [];
            
            // Simple pattern matching for demo
            if (text.includes('æˆ‘åƒé¥­åœ¨é¤å…')) {
                corrections.push('è¯­åºå»ºè®®ï¼šåº”è¯¥è¯´"æˆ‘åœ¨é¤å…åƒé¥­"è€Œä¸æ˜¯"æˆ‘åƒé¥­åœ¨é¤å…"ã€‚ä¸­æ–‡é‡Œåœ°ç‚¹çŠ¶è¯­é€šå¸¸æ”¾åœ¨åŠ¨è¯å‰é¢ã€‚');
            }
            if (text.includes('ä¸') && text.includes('å—')) {
                corrections.push('æ³¨æ„ï¼šç–‘é—®å¥ä¸­"å—"å·²ç»è¡¨ç¤ºç–‘é—®ï¼Œä¸éœ€è¦å†åŠ "ä¸"ã€‚ä¾‹å¦‚ï¼š"ä½ å¥½å—ï¼Ÿ"è€Œä¸æ˜¯"ä½ ä¸å¥½å—ï¼Ÿ"ï¼ˆé™¤éçœŸçš„æƒ³é—®è´Ÿé¢é—®é¢˜ï¼‰');
            }
            
            if (corrections.length > 0) {
                document.getElementById('correction-panel').classList.remove('hidden');
                panel.innerHTML = corrections.map(c => `<div class="p-2 bg-white rounded border-l-4 border-amber-400 text-amber-900">${c}</div>`).join('');
            }
        }

        function toggleCorrectionPanel() {
            document.getElementById('correction-panel').classList.toggle('hidden');
        }

        function handleKeyPress(e) {
            if (e.key === 'Enter') sendMessage();
        }

        function toggleInputMode() {
            const textInput = document.getElementById('text-input');
            const voiceInput = document.getElementById('voice-input');
            
            if (textInput.classList.contains('hidden')) {
                textInput.classList.remove('hidden');
                voiceInput.classList.add('hidden');
            } else {
                textInput.classList.add('hidden');
                voiceInput.classList.remove('hidden');
            }
        }

        function toggleRecording() {
            const btn = document.getElementById('voice-input');
            
            if (!isRecording) {
                isRecording = true;
                btn.classList.add('recording-pulse', 'bg-red-50');
                btn.querySelector('span').innerHTML = '<span class="w-2 h-2 bg-white rounded-full animate-pulse"></span> å½•éŸ³ä¸­... Recording';
                
                // Simulate recording for 3 seconds
                setTimeout(() => {
                    if (isRecording) {
                        toggleRecording();
                        // Simulate transcribed text
                        document.getElementById('text-input').value = 'æˆ‘æƒ³å»é¤å…åƒé¥­';
                        toggleInputMode();
                        sendMessage();
                    }
                }, 3000);
            } else {
                isRecording = false;
                btn.classList.remove('recording-pulse', 'bg-red-50');
                btn.querySelector('span').innerHTML = '<span class="w-2 h-2 bg-cinnabar rounded-full animate-pulse"></span> æŒ‰ä½è¯´è¯ Hold to Speak';
            }
        }

        // Explore Section
        function switchExploreTab(tab) {
            // Hide all content
            document.querySelectorAll('.explore-content').forEach(c => c.classList.add('hidden'));
            document.getElementById('explore-' + tab).classList.remove('hidden');
            
            // Update buttons
            document.querySelectorAll('.explore-tab').forEach(b => {
                b.classList.remove('bg-cinnabar', 'text-white');
                b.classList.add('bg-white', 'text-stone-600', 'border', 'border-stone-200');
            });
            event.target.classList.remove('bg-white', 'text-stone-600', 'border', 'border-stone-200');
            event.target.classList.add('bg-cinnabar', 'text-white');
        }

        function openScene(sceneId) {
            const scene = sceneData[sceneId];
            if (!scene) return;
            
            document.getElementById('scene-title').textContent = scene.title;
            const content = document.getElementById('scene-content');
            
            content.innerHTML = scene.phrases.map((p, i) => `
                <div class="mb-6 p-4 bg-stone-50 rounded-xl hover:bg-stone-100 transition-colors">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-bold text-cinnabar">#${i + 1}</span>
                        <button onclick="speakText('${p.cn}')" class="text-stone-400 hover:text-cinnabar">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                        </button>
                    </div>
                    <div class="text-2xl font-bold mb-1 cursor-pointer" onmouseover="showPinyin(this)" onmouseout="hidePinyin(this)" data-pinyin="${p.py}">${p.cn}</div>
                    <div class="text-sm text-stone-500 mb-1">${p.py}</div>
                    <div class="text-stone-600">${p.en}</div>
                </div>
            `).join('');
            
            document.getElementById('scene-modal').classList.remove('hidden');
        }

        function closeScene() {
            document.getElementById('scene-modal').classList.add('hidden');
        }

        function showPinyin(el) {
            // Could add tooltip logic here
            el.style.color = '#c41e3a';
        }

        function hidePinyin(el) {
            el.style.color = '';
        }

        function playStory(storyId) {
            const text = storyId === 'hua-long-dian-jing' ? 
                'ä¼ è¯´å¤æ—¶å€™æœ‰ä¸ªç”»å®¶å«å¼ åƒ§ç¹‡ï¼Œä»–åœ¨å¯ºåº™çš„å¢™ä¸Šç”»äº†å››æ¡é¾™ï¼Œä½†éƒ½æ²¡æœ‰ç”»çœ¼ç›ã€‚' :
                'ä¸­ç§‹èŠ‚æ˜¯ä¸­å›½ä¼ ç»Ÿçš„èŠ‚æ—¥ã€‚æ¯å¹´çš„å†œå†å…«æœˆåäº”ï¼Œæœˆäº®ç‰¹åˆ«åœ†ï¼Œç‰¹åˆ«äº®ã€‚';
            speakText(text);
        }

        // Utilities
        function speakText(text) {
            if ('speechSynthesis' in window) {
                // Cancel current speech
                window.speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = parseFloat(document.getElementById('speed-control')?.value || 1);
                utterance.pitch = 1;
                
                window.speechSynthesis.speak(utterance);
            }
        }

        function updateSettings() {
            // Settings are applied in speakText via speed-control
            console.log('Settings updated');
        }

        function startPracticeTimer() {
            practiceTimer = setInterval(() => {
                practiceTime++;
                const mins = Math.floor(practiceTime / 60).toString().padStart(2, '0');
                const secs = (practiceTime % 60).toString().padStart(2, '0');
                document.getElementById('practice-time').textContent = `${mins}:${secs}`;
            }, 1000);
        }

        function stopPracticeTimer() {
            clearInterval(practiceTimer);
            practiceTimer = null;
        }

        function endChat() {
            if (confirm('ç¡®å®šè¦ç»“æŸå½“å‰å¯¹è¯å—ï¼Ÿç»ƒä¹ æŠ¥å‘Šå°†ä¸ä¼šä¿å­˜ã€‚')) {
                switchMode('home');
            }
        }

        function updateOnlineCount() {
            // Simulate fluctuating user count
            const base = 1200;
            const variance = Math.floor(Math.random() * 100);
            document.getElementById('online-count').textContent = (base + variance).toLocaleString();
        }

        function loadDailyPhrase() {
            const phrases = [
                { cn: 'åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹', py: 'QiÄn lÇ zhÄ« xÃ­ng, shÇ yÃº zÃº xiÃ ', en: 'A journey of a thousand miles begins with a single step.' },
                { cn: 'æ´»åˆ°è€ï¼Œå­¦åˆ°è€', py: 'HuÃ³ dÃ o lÇo, xuÃ© dÃ o lÇo', en: 'One is never too old to learn.' },
                { cn: 'æœ‰æœ‹è‡ªè¿œæ–¹æ¥ï¼Œä¸äº¦ä¹ä¹', py: 'YÇ’u pÃ©ng zÃ¬ yuÇnfÄng lÃ¡i, bÃ¹ yÃ¬ lÃ¨ hÅ«', en: 'Is it not a joy to have friends coming from afar?' }
            ];
            const today = new Date().getDay();
            const phrase = phrases[today % phrases.length];
            
            document.getElementById('daily-phrase').textContent = phrase.cn;
            document.getElementById('daily-pinyin').textContent = phrase.py;
            document.getElementById('daily-meaning').textContent = phrase.en;
        }

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            const nav = document.getElementById('navbar');
            if (window.scrollY > 50) {
                nav.classList.add('shadow-md');
            } else {
                nav.classList.remove('shadow-md');
            }
        });
    </script>
</body>
</html>