<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandarin Mate - 沉浸式普通话学习平台</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary: #4a6fa5;
            --primary-light: #6d8cc2;
            --secondary: #ff7e5f;
            --accent: #17b890;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --red: #dc3545;
            --pink: #f8d7da;
            --green: #198754;
            --blue: #0d6efd;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }
        
        /* 欢迎屏幕 */
        .welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 0.5s ease;
        }
        
        .welcome-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .welcome-content {
            text-align: center;
            color: white;
            padding: 40px;
            max-width: 600px;
        }
        
        .welcome-content h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .welcome-content .slogan {
            font-size: 1.5rem;
            margin-bottom: 40px;
            opacity: 0.9;
        }
        
        .welcome-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .btn-welcome {
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-primary-welcome {
            background-color: white;
            color: #764ba2;
        }
        
        .btn-outline-welcome {
            background-color: transparent;
            border: 2px solid white;
            color: white;
        }
        
        .btn-primary-welcome:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .btn-outline-welcome:hover {
            background-color: white;
            color: #764ba2;
        }
        
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            height: 100vh;
            overflow: hidden;
            box-shadow: var(--shadow);
            border-radius: 12px;
            background-color: white;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .container.show {
            opacity: 1;
        }
        
        /* 左侧语伴栏 */
        .sidebar {
            width: 320px;
            background-color: white;
            border-right: 1px solid var(--gray-light);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* 顶部导航栏 */
        .top-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid var(--gray-light);
            background-color: white;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background-color: var(--red);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .logo-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        
        .guest-badge {
            background-color: var(--green);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .nav-links {
            display: flex;
            gap: 24px;
        }
        
        .nav-item {
            color: var(--gray);
            text-decoration: none;
            font-size: 0.95rem;
            padding: 8px 0;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .nav-item.active {
            color: var(--red);
            border-color: var(--red);
        }
        
        /* 语伴选择区 */
        .pals-section {
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .section-title {
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .section-desc {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 20px;
        }
        
        .pals-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .pal-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background-color: var(--light);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .pal-item:hover {
            background-color: #f1f3f5;
            transform: translateY(-2px);
        }
        
        .pal-item.active {
            border-color: var(--red);
            background-color: rgba(220, 53, 69, 0.05);
        }
        
        .pal-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
            margin-right: 12px;
            position: relative;
        }
        
        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .online-status {
            width: 10px;
            height: 10px;
            background-color: var(--green);
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            right: 0;
            border: 2px solid white;
        }
        
        .pal-info h3 {
            font-size: 1.05rem;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .pal-info p {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        /* 学习设置面板 */
        .settings-panel {
            padding: 20px;
            border-top: 1px solid var(--gray-light);
            background-color: white;
        }
        
        .settings-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            color: var(--dark);
            font-size: 1.05rem;
        }
        
        .setting-item {
            margin-bottom: 20px;
        }
        
        .setting-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: var(--gray);
        }
        
        .slider-container {
            position: relative;
            height: 6px;
            background-color: var(--gray-light);
            border-radius: 3px;
            cursor: pointer;
        }
        
        .slider-track {
            position: absolute;
            height: 100%;
            background-color: var(--primary);
            border-radius: 3px;
            width: 60%;
        }
        
        .slider-handle {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            background-color: white;
            border: 2px solid var(--primary);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            cursor: pointer;
            left: 60%;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .select-box {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            background-color: var(--light);
            font-size: 0.9rem;
            color: var(--dark);
            appearance: none;
            cursor: pointer;
        }
        
        /* 右侧主内容区 */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #f8f9fa;
        }
        
        /* 聊天头部 */
        .chat-header {
            padding: 16px 20px;
            background-color: white;
            border-bottom: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .chat-info-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
        }
        
        .chat-info h2 {
            font-size: 1.1rem;
            color: var(--dark);
        }
        
        .chat-info p {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .mode-selector {
            display: flex;
            background-color: var(--light);
            border-radius: 8px;
            padding: 4px;
            margin-top: 8px;
        }
        
        .mode-btn {
            padding: 6px 12px;
            border-radius: 6px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }
        
        .mode-btn.active {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-danger {
            background-color: var(--red);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        /* 聊天消息区 */
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            position: relative;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .message.user {
            align-self: flex-end;
            background-color: var(--primary);
            color: white;
            border-bottom-right-radius: 4px;
        }
        
        .message.bot {
            align-self: flex-start;
            background-color: white;
            color: var(--dark);
            border-bottom-left-radius: 4px;
            border: 1px solid var(--gray-light);
        }
        
        .message-time {
            font-size: 0.75rem;
            color: var(--gray);
            margin-top: 4px;
            text-align: right;
        }
        
        /* 语音输入区域 */
        .voice-input-area {
            padding: 20px;
            background-color: white;
            border-top: 1px solid var(--gray-light);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            display: none;
        }
        
        .voice-btn {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--red);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        
        .voice-btn.recording {
            background-color: #dc3545;
            animation: pulse 1.5s infinite;
            transform: scale(1.1);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        
        .voice-instruction {
            text-align: center;
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .voice-timer {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--dark);
        }
        
        /* 文字输入区域 */
        .text-input-area {
            padding: 16px 20px;
            background-color: white;
            border-top: 1px solid var(--gray-light);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .input-container {
            flex: 1;
            position: relative;
        }
        
        .input-field {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--gray-light);
            border-radius: 24px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s ease;
        }
        
        .input-field:focus {
            border-color: var(--primary);
        }
        
        .input-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--gray-light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .action-btn:hover {
            background-color: var(--gray);
            color: white;
        }
        
        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .send-btn:hover {
            background-color: var(--primary-light);
        }
        
        /* 对话报告 */
        .report-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .report-modal.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .report-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .report-header h2 {
            color: var(--dark);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
        }
        
        .report-section {
            margin-bottom: 25px;
        }
        
        .report-section h3 {
            color: var(--primary);
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--gray-light);
        }
        
        .strength-list, .improvement-list {
            list-style-type: none;
            padding-left: 0;
        }
        
        .strength-list li, .improvement-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .strength-list li:before {
            content: "✓ ";
            color: var(--green);
            font-weight: bold;
        }
        
        .improvement-list li:before {
            content: "➤ ";
            color: var(--red);
            font-weight: bold;
        }
        
        .rating {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .stars {
            color: #ffc107;
        }
        
        /* 资料库界面 */
        .library-content {
            display: none;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .library-content.show {
            display: block;
        }
        
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .library-item {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .library-item:hover {
            transform: translateY(-5px);
        }
        
        .library-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .library-info {
            padding: 20px;
        }
        
        .library-info h3 {
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .library-info p {
            color: var(--gray);
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        /* 模拟滚动到底部 */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background-color: var(--gray-light);
            border-radius: 10px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background-color: var(--gray);
        }
        
        /* 响应式调整 */
        @media (max-width: 1024px) {
            .container {
                border-radius: 0;
            }
            .sidebar {
                width: 280px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
                min-height: 100vh;
            }
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid var(--gray-light);
            }
            .main-content {
                height: calc(100vh - 60px);
            }
            
            .welcome-content h1 {
                font-size: 2.5rem;
            }
            
            .welcome-content .slogan {
                font-size: 1.2rem;
            }
            
            .welcome-buttons {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- 欢迎屏幕 -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-content">
            <h1>Mandarin Mate</h1>
            <div class="slogan">Free Mandarin Practice</div>
            <p>沉浸式普通话学习平台 - 无需注册，立即开始练习</p>
            <div class="welcome-buttons">
                <button class="btn-welcome btn-primary-welcome" id="startAsGuest">
                    <i class="fas fa-user-circle"></i> 以游客身份开始
                </button>
                <button class="btn-welcome btn-outline-welcome" id="signIn">
                    <i class="fas fa-sign-in-alt"></i> 登录/注册
                </button>
            </div>
        </div>
    </div>

    <!-- 主界面 -->
    <div class="container" id="mainContainer">
        <!-- 左侧栏 -->
        <div class="sidebar">
            <!-- 顶部导航 -->
            <div class="top-nav">
                <div class="logo-container">
                    <div class="logo-icon">友</div>
                    <div class="logo-text">Mandarin Mate</div>
                </div>
                <div class="guest-badge">游客模式</div>
            </div>

            <!-- 导航链接 -->
            <div class="top-nav" style="justify-content: center; padding-top: 5px;">
                <div class="nav-links">
                    <div class="nav-item active" data-page="chat">
                        <i class="fas fa-comments"></i> 沉浸对话
                    </div>
                    <div class="nav-item" data-page="library">
                        <i class="fas fa-book"></i> 资料库
                    </div>
                    <div class="nav-item" data-page="about">
                        <i class="fas fa-info-circle"></i> 关于我们
                    </div>
                </div>
            </div>

            <!-- 语伴列表 -->
            <div class="pals-section">
                <div class="section-title">选择你的语伴</div>
                <div class="section-desc">选择适合你的学习伙伴开始练习</div>
                
                <div class="pals-list">
                    <!-- 语伴 1 -->
                    <div class="pal-item active" data-pal="1">
                        <div class="pal-avatar">
                            <div class="avatar-img" style="background-color: #4a6fa5; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div class="online-status"></div>
                        </div>
                        <div class="pal-info">
                            <h3>李晓</h3>
                            <p>标准普通话导师</p>
                        </div>
                    </div>

                    <!-- 语伴 2 -->
                    <div class="pal-item" data-pal="2">
                        <div class="pal-avatar">
                            <div class="avatar-img" style="background-color: #ff7e5f; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                <i class="fas fa-street-view"></i>
                            </div>
                            <div class="online-status"></div>
                        </div>
                        <div class="pal-info">
                            <h3>阿强</h3>
                            <p>街头口语达人</p>
                        </div>
                    </div>

                    <!-- 语伴 3 -->
                    <div class="pal-item" data-pal="3">
                        <div class="pal-avatar">
                            <div class="avatar-img" style="background-color: #17b890; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <div class="online-status"></div>
                        </div>
                        <div class="pal-info">
                            <h3>王总</h3>
                            <p>商务场景专家</p>
                        </div>
                    </div>

                    <!-- 语伴 4 -->
                    <div class="pal-item" data-pal="4">
                        <div class="pal-avatar">
                            <div class="avatar-img" style="background-color: #9d4edd; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.5rem;">
                                <i class="fas fa-plane"></i>
                            </div>
                            <div class="online-status"></div>
                        </div>
                        <div class="pal-info">
                            <h3>旅行助手</h3>
                            <p>旅行必备用语专家</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 学习设置 -->
            <div class="settings-panel">
                <div class="settings-title">
                    <i class="fas fa-cog"></i>
                    学习设置
                </div>
                
                <div class="setting-item">
                    <div class="setting-label">
                        <span>语速 Speed</span>
                    </div>
                    <div class="slider-container" id="speedSlider">
                        <div class="slider-track" style="width: 60%;"></div>
                        <div class="slider-handle" style="left: 60%;"></div>
                    </div>
                    <div class="slider-labels">
                        <span>慢</span>
                        <span>标准</span>
                        <span>快</span>
                    </div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-label">
                        <span>难度 HSK Level</span>
                    </div>
                    <select class="select-box" id="difficultySelect">
                        <option>HSK 1 (入门级)</option>
                        <option selected>HSK 2 (基础级)</option>
                        <option>HSK 3 (初级)</option>
                        <option>HSK 4 (中级)</option>
                        <option>HSK 5 (高级)</option>
                        <option>HSK 6 (精通级)</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 右侧主内容区 -->
        <div class="main-content">
            <!-- 聊天头部 -->
            <div class="chat-header">
                <div class="chat-info-container">
                    <div class="chat-avatar">
                        <div class="avatar-img" style="background-color: #4a6fa5; display: flex; align-items: center; justify-content: center; color: white; font-size: 1.8rem;">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                    </div>
                    <div class="chat-info">
                        <h2>李晓 - 标准普通话导师</h2>
                        <p>正在和您对话... 已连接</p>
                        <div class="mode-selector">
                            <button class="mode-btn active" data-mode="voice-hold">按住说话</button>
                            <button class="mode-btn" data-mode="voice-call">实时通话</button>
                        </div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-outline" id="pronunciationGuide">
                        <i class="fas fa-volume-up"></i> 发音指导
                    </button>
                    <button class="btn btn-primary" id="newConversation">
                        <i class="fas fa-sync-alt"></i> 新对话
                    </button>
                    <button class="btn btn-danger" id="endConversation">
                        <i class="fas fa-flag-checkered"></i> 结束对话
                    </button>
                </div>
            </div>

            <!-- 聊天界面 -->
            <div id="chatInterface">
                <!-- 聊天消息区 -->
                <div class="chat-messages" id="chatMessages">
                    <!-- 语伴欢迎消息 -->
                    <div class="message bot">
                        <div class="message-content">
                            你好！我是李晓，你的普通话导师。欢迎使用Mandarin Mate！我们可以通过两种方式练习对话：
                            <br><br>
                            1. <strong>按住说话</strong>：像微信语音一样，按住按钮说话
                            <br>
                            2. <strong>实时通话</strong>：像打电话一样连续对话
                            <br><br>
                            你希望使用哪种方式呢？
                        </div>
                        <div class="message-time">刚刚</div>
                    </div>
                </div>

                <!-- 语音输入区域 -->
                <div class="voice-input-area" id="voiceInputArea">
                    <div class="voice-timer" id="voiceTimer">00:00</div>
                    <button class="voice-btn" id="voiceBtn">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <div class="voice-instruction" id="voiceInstruction">
                        按住按钮开始说话，松开结束
                    </div>
                    <div style="font-size: 0.8rem; color: var(--gray); text-align: center;">
                        提示：尝试说一些简单的中文，比如"你好"、"谢谢"
                    </div>
                </div>

                <!-- 文字输入区域 -->
                <div class="text-input-area" id="textInputArea">
                    <div class="input-container">
                        <input type="text" class="input-field" id="messageInput" placeholder="输入您的回复或问题... (按Enter发送)">
                    </div>
                    <div class="input-actions">
                        <div class="action-btn" id="toggleVoiceBtn">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <div class="action-btn">
                            <i class="far fa-image"></i>
                        </div>
                    </div>
                    <div class="send-btn" id="sendBtn">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                </div>
            </div>

            <!-- 资料库界面 -->
            <div class="library-content" id="libraryContent">
                <h2 style="margin-bottom: 20px;">学习资料库</h2>
                <div class="library-grid">
                    <div class="library-item">
                        <img src="https://images.unsplash.com/photo-1585032226651-759b368d7246?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="火锅" class="library-img">
                        <div class="library-info">
                            <h3>火锅 (Huǒguō) - Hot Pot</h3>
                            <p>火锅是中国传统饮食方式，起源于四川。它是一种在餐桌上边煮边吃的烹饪方式，通常将肉类、蔬菜、豆腐等食材放入滚烫的汤底中涮煮后食用。</p>
                        </div>
                    </div>
                    <div class="library-item">
                        <img src="https://images.unsplash.com/photo-1547592180-85f173990554?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="饺子" class="library-img">
                        <div class="library-info">
                            <h3>饺子 (Jiǎozi) - Dumplings</h3>
                            <p>饺子是中国传统食物，由面皮包裹馅料制成。通常在春节等重要节日食用，象征着团圆和财富。</p>
                        </div>
                    </div>
                    <div class="library-item">
                        <img src="https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="宫保鸡丁" class="library-img">
                        <div class="library-info">
                            <h3>宫保鸡丁 (Gōngbǎo Jīdīng) - Kung Pao Chicken</h3>
                            <p>宫保鸡丁是著名的四川菜肴，由鸡肉、花生、辣椒和花椒制成。口感麻辣鲜香，深受国内外食客喜爱。</p>
                        </div>
                    </div>
                    <div class="library-item">
                        <img src="https://images.unsplash.com/photo-1569718212165-3a8278d5f624?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="茶" class="library-img">
                        <div class="library-info">
                            <h3>茶 (Chá) - Tea</h3>
                            <p>茶是中国传统文化的重要组成部分，有着4000多年的历史。中国茶主要分为绿茶、红茶、乌龙茶、白茶、黄茶和黑茶六大类。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 对话报告模态框 -->
    <div class="report-modal" id="reportModal">
        <div class="report-content">
            <div class="report-header">
                <h2>对话报告</h2>
                <button class="close-btn" id="closeReport">&times;</button>
            </div>
            
            <div class="report-section">
                <h3>本次对话总结</h3>
                <p>您与李晓进行了3分钟的普通话练习对话，共交流了15轮对话。</p>
                <div class="rating">
                    <span>总体评分：</span>
                    <div class="stars">
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star"></i>
                        <i class="fas fa-star-half-alt"></i>
                    </div>
                    <span>4.5/5</span>
                </div>
            </div>
            
            <div class="report-section">
                <h3>发音优点</h3>
                <ul class="strength-list">
                    <li>声调准确：你的"你好"发音很标准</li>
                    <li>语速适中：非常适合日常交流</li>
                    <li>词汇运用：能正确使用"谢谢"、"再见"等基础词汇</li>
                    <li>流畅度：句子之间的停顿自然</li>
                </ul>
            </div>
            
            <div class="report-section">
                <h3>需要改进的地方</h3>
                <ul class="improvement-list">
                    <li><strong>"火锅 (Huǒguō)"</strong>：注意"火"的第三声要完整，你发成了第二声</li>
                    <li><strong>"餐厅 (Cāntīng)"</strong>："餐"的平舌音可以更清晰</li>
                    <li><strong>"多少钱 (Duōshǎo qián)"</strong>：注意"少"的第三声转折</li>
                    <li>尝试使用更复杂的句子结构，如"我想点一份..."</li>
                </ul>
            </div>
            
            <div class="report-section">
                <h3>学习建议</h3>
                <p>建议每天练习15分钟，重点关注声调准确性。可以尝试我们的"发音指导"功能来针对性练习。查看资料库中关于"火锅"的内容，了解更多相关词汇和文化背景。</p>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" id="viewLibraryFromReport">
                    <i class="fas fa-book"></i> 查看资料库
                </button>
                <button class="btn btn-outline" style="margin-left: 10px;" id="practiceAgain">
                    <i class="fas fa-redo"></i> 再次练习
                </button>
            </div>
        </div>
    </div>

    <script>
        // 用户旅程状态管理
        let currentUserJourney = {
            step: 'welcome', // welcome, pal-selected, voice-mode, call-mode, conversation-end
            currentPal: 1,
            conversationMode: 'voice-hold', // voice-hold, voice-call
            conversationHistory: [],
            startTime: null,
            voiceRecording: false,
            recordingTimer: null,
            recordingSeconds: 0
        };

        // DOM元素
        const welcomeScreen = document.getElementById('welcomeScreen');
        const mainContainer = document.getElementById('mainContainer');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const voiceInputArea = document.getElementById('voiceInputArea');
        const textInputArea = document.getElementById('textInputArea');
        const voiceBtn = document.getElementById('voiceBtn');
        const voiceTimer = document.getElementById('voiceTimer');
        const voiceInstruction = document.getElementById('voiceInstruction');
        const toggleVoiceBtn = document.getElementById('toggleVoiceBtn');
        const modeButtons = document.querySelectorAll('.mode-btn');
        const palItems = document.querySelectorAll('.pal-item');
        const navItems = document.querySelectorAll('.nav-item');
        const reportModal = document.getElementById('reportModal');
        const closeReportBtn = document.getElementById('closeReport');
        const endConversationBtn = document.getElementById('endConversation');
        const libraryContent = document.getElementById('libraryContent');
        const chatInterface = document.getElementById('chatInterface');
        const viewLibraryFromReport = document.getElementById('viewLibraryFromReport');
        const practiceAgainBtn = document.getElementById('practiceAgain');
        const newConversationBtn = document.getElementById('newConversation');
        const pronunciationGuideBtn = document.getElementById('pronunciationGuide');

        // 初始化用户旅程
        function initUserJourney() {
            // 1. 进入网站：看到Slogan "Free Mandarin Practice"，无需注册即可试用（Guest Mode）
            document.getElementById('startAsGuest').addEventListener('click', startAsGuest);
            document.getElementById('signIn').addEventListener('click', signIn);
            
            // 2. 选择角色：点击"李晓"
            palItems.forEach(item => {
                item.addEventListener('click', selectPal);
            });
            
            // 3. 开始对话：方式A（按住说话）和方式B（实时通话）
            modeButtons.forEach(btn => {
                btn.addEventListener('click', switchConversationMode);
            });
            
            // 语音按钮事件
            voiceBtn.addEventListener('mousedown', startVoiceRecording);
            voiceBtn.addEventListener('mouseup', stopVoiceRecording);
            voiceBtn.addEventListener('touchstart', startVoiceRecording);
            voiceBtn.addEventListener('touchend', stopVoiceRecording);
            
            toggleVoiceBtn.addEventListener('click', toggleVoiceInput);
            
            // 发送消息事件
            sendBtn.addEventListener('click', sendTextMessage);
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendTextMessage();
                }
            });
            
            // 导航切换
            navItems.forEach(item => {
                item.addEventListener('click', switchPage);
            });
            
            // 结束对话按钮
            endConversationBtn.addEventListener('click', endConversation);
            
            // 报告相关事件
            closeReportBtn.addEventListener('click', closeReport);
            viewLibraryFromReport.addEventListener('click', viewLibrary);
            practiceAgainBtn.addEventListener('click', practiceAgain);
            
            // 新对话按钮
            newConversationBtn.addEventListener('click', startNewConversation);
            
            // 发音指导按钮
            pronunciationGuideBtn.addEventListener('click', showPronunciationGuide);
        }

        // 以游客身份开始
        function startAsGuest() {
            welcomeScreen.classList.add('hidden');
            setTimeout(() => {
                mainContainer.classList.add('show');
                currentUserJourney.step = 'pal-selected';
                
                // 显示欢迎消息
                addMessageToChat('欢迎使用游客模式！你可以免费试用所有功能。请选择一位语伴开始练习。', 'bot');
            }, 300);
        }

        // 登录/注册（模拟）
        function signIn() {
            alert('登录/注册功能正在开发中... 目前以游客身份继续');
            startAsGuest();
        }

        // 选择语伴
        function selectPal(e) {
            const palItem = e.currentTarget;
            const palId = palItem.getAttribute('data-pal');
            
            // 移除所有active类
            palItems.forEach(item => item.classList.remove('active'));
            // 添加active类到当前选择的语伴
            palItem.classList.add('active');
            
            // 更新当前语伴信息
            const palNames = {
                1: '李晓 - 标准普通话导师',
                2: '阿强 - 街头口语达人',
                3: '王总 - 商务场景专家',
                4: '旅行助手 - 旅行必备用语专家'
            };
            
            const palDescriptions = {
                1: '专业中文教师，帮助您掌握标准发音和语法',
                2: '学习地道日常用语，了解中国流行文化',
                3: '商务会议、谈判、邮件等专业场景用语',
                4: '餐厅点餐、酒店入住、问路等旅行必备用语'
            };
            
            document.querySelector('.chat-info h2').textContent = palNames[palId];
            document.querySelector('.chat-info p').textContent = '正在和您对话... 已连接';
            
            // 更新头像
            const avatar = document.querySelector('.chat-avatar .avatar-img');
            const colors = ['#4a6fa5', '#ff7e5f', '#17b890', '#9d4edd'];
            avatar.style.backgroundColor = colors[palId-1];
            
            // 更新用户旅程状态
            currentUserJourney.currentPal = parseInt(palId);
            currentUserJourney.step = 'voice-mode';
            
            // 显示选择确认消息
            addMessageToChat(`你已经选择了${palNames[palId].split(' - ')[0]}！现在你可以选择对话方式：按住说话或实时通话。`, 'bot');
            
            // 显示对话模式选择提示
            setTimeout(() => {
                addMessageToChat('请选择对话模式：<br>1. <strong>按住说话</strong>：像微信语音一样，按住按钮说话<br>2. <strong>实时通话</strong>：像打电话一样连续对话', 'bot');
            }, 500);
        }

        // 切换对话模式
        function switchConversationMode(e) {
            const mode = e.currentTarget.getAttribute('data-mode');
            
            // 更新按钮状态
            modeButtons.forEach(btn => btn.classList.remove('active'));
            e.currentTarget.classList.add('active');
            
            // 更新用户旅程状态
            currentUserJourney.conversationMode = mode;
            currentUserJourney.step = mode === 'voice-hold' ? 'voice-mode' : 'call-mode';
            
            // 显示/隐藏相应的输入区域
            if (mode === 'voice-hold') {
                voiceInputArea.style.display = 'flex';
                textInputArea.style.display = 'none';
                voiceInstruction.textContent = '按住按钮开始说话，松开结束';
                
                addMessageToChat('已切换到"按住说话"模式。请按住麦克风按钮开始说话，松开按钮结束。', 'bot');
            } else {
                voiceInputArea.style.display = 'none';
                textInputArea.style.display = 'flex';
                voiceInstruction.textContent = '实时通话模式已激活';
                
                addMessageToChat('已切换到"实时通话"模式。现在可以像打电话一样连续对话。', 'bot');
                addMessageToChat('模拟通话开始... 请开始说话（输入文字模拟语音输入）', 'bot');
            }
            
            // 如果是第一次开始对话，记录开始时间
            if (!currentUserJourney.startTime) {
                currentUserJourney.startTime = new Date();
                addMessageToChat('对话已开始！系统会记录你的练习表现。', 'bot');
            }
        }

        // 开始语音录制
        function startVoiceRecording() {
            if (currentUserJourney.voiceRecording) return;
            
            currentUserJourney.voiceRecording = true;
            voiceBtn.classList.add('recording');
            voiceInstruction.textContent = '正在录音... 请说话';
            
            // 开始计时
            currentUserJourney.recordingSeconds = 0;
            currentUserJourney.recordingTimer = setInterval(() => {
                currentUserJourney.recordingSeconds++;
                const minutes = Math.floor(currentUserJourney.recordingSeconds / 60);
                const seconds = currentUserJourney.recordingSeconds % 60;
                voiceTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
            
            // 模拟语音识别中
            setTimeout(() => {
                if (currentUserJourney.voiceRecording) {
                    // 模拟识别结果
                    const samplePhrases = [
                        "你好，我想学习中文",
                        "今天天气很好",
                        "我喜欢吃中国菜",
                        "请问洗手间在哪里",
                        "这个多少钱",
                        "谢谢你的帮助"
                    ];
                    
                    const randomPhrase = samplePhrases[Math.floor(Math.random() * samplePhrases.length)];
                    simulateVoiceRecognition(randomPhrase);
                }
            }, 2000);
        }

        // 停止语音录制
        function stopVoiceRecording() {
            if (!currentUserJourney.voiceRecording) return;
            
            currentUserJourney.voiceRecording = false;
            voiceBtn.classList.remove('recording');
            voiceInstruction.textContent = '按住按钮开始说话，松开结束';
            
            // 停止计时
            clearInterval(currentUserJourney.recordingTimer);
            voiceTimer.textContent = '00:00';
            
            // 记录对话
            if (currentUserJourney.recordingSeconds > 1) {
                currentUserJourney.conversationHistory.push({
                    type: 'voice',
                    duration: currentUserJourney.recordingSeconds,
                    timestamp: new Date()
                });
            }
        }

        // 模拟语音识别
        function simulateVoiceRecognition(text) {
            // 添加用户消息
            addMessageToChat(text, 'user');
            
            // 模拟语伴回复
            setTimeout(() => {
                const responses = [
                    `你说的是："${text}"。发音不错！`,
                    `我听到你说："${text}"。继续练习！`,
                    `"${text}" - 说得很好！`,
                    `你说了"${text}"，发音很清晰。`
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessageToChat(randomResponse, 'bot');
            }, 1000);
        }

        // 切换语音/文字输入
        function toggleVoiceInput() {
            if (currentUserJourney.conversationMode === 'voice-hold') {
                // 切换到文字输入
                voiceInputArea.style.display = 'none';
                textInputArea.style.display = 'flex';
                addMessageToChat('已切换到文字输入模式。', 'bot');
            } else {
                // 切换到语音输入
                voiceInputArea.style.display = 'flex';
                textInputArea.style.display = 'none';
                addMessageToChat('已切换到语音输入模式。', 'bot');
            }
        }

        // 发送文字消息
        function sendTextMessage() {
            const text = messageInput.value.trim();
            if (text === '') return;
            
            addMessageToChat(text, 'user');
            messageInput.value = '';
            
            // 模拟语伴回复
            setTimeout(() => {
                const botResponses = [
                    "我明白你的意思了。继续练习！",
                    "这个表达很地道！",
                    "你的中文进步很快！",
                    "我们可以继续这个话题，或者你想换一个主题？"
                ];
                const randomResponse = botResponses[Math.floor(Math.random() * botResponses.length)];
                addMessageToChat(randomResponse, 'bot');
                
                // 记录对话
                currentUserJourney.conversationHistory.push({
                    type: 'text',
                    content: text,
                    timestamp: new Date()
                });
            }, 800);
        }

        // 添加消息到聊天窗口
        function addMessageToChat(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'user' ? 'user' : 'bot'}`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', { 
                hour: '2-digit', 
                minute: '2-digit',
                hour12: false 
            }).replace(/^24:/, '00:');
            
            messageDiv.innerHTML = `
                <div class="message-content">
                    <div class="message-text">${text}</div>
                    <div class="message-time">${timeString}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // 结束对话并生成报告
        function endConversation() {
            if (currentUserJourney.conversationHistory.length === 0) {
                alert('请先开始一段对话再生成报告。');
                return;
            }
            
            // 计算对话时长
            const endTime = new Date();
            const duration = currentUserJourney.startTime ? 
                Math.round((endTime - currentUserJourney.startTime) / 1000 / 60) : 3; // 分钟
            
            // 显示报告
            showConversationReport(duration);
            
            // 重置对话状态
            currentUserJourney.step = 'conversation-end';
            currentUserJourney.startTime = null;
            currentUserJourney.conversationHistory = [];
            
            // 添加结束消息
            addMessageToChat('对话已结束。查看上方的对话报告，了解你的表现和改进建议。', 'bot');
        }

        // 显示对话报告
        function showConversationReport(duration) {
            // 更新报告内容
            const reportContent = document.querySelector('.report-content');
            reportContent.querySelector('p').textContent = 
                `您与${document.querySelector('.chat-info h2').textContent.split(' - ')[0]}进行了${duration}分钟的普通话练习对话，共交流了${Math.floor(Math.random() * 10) + 10}轮对话。`;
            
            // 显示报告
            reportModal.classList.add('show');
        }

        // 关闭报告
        function closeReport() {
            reportModal.classList.remove('show');
        }

        // 查看资料库
        function viewLibrary() {
            closeReport();
            
            // 切换到资料库页面
            navItems.forEach(item => item.classList.remove('active'));
            document.querySelector('[data-page="library"]').classList.add('active');
            
            chatInterface.style.display = 'none';
            libraryContent.classList.add('show');
            
            // 添加关于火锅的消息
            addMessageToChat('你可以在资料库中查看关于"火锅"的详细信息。休息一下，学习一些文化知识吧！', 'bot');
        }

        // 再次练习
        function practiceAgain() {
            closeReport();
            startNewConversation();
        }

        // 开始新对话
        function startNewConversation() {
            // 清空聊天记录
            chatMessages.innerHTML = '';
            
            // 添加欢迎消息
            addMessageToChat('开始新的对话！请选择对话模式开始练习。', 'bot');
            
            // 重置状态
            currentUserJourney.startTime = new Date();
            currentUserJourney.conversationHistory = [];
            
            // 确保显示聊天界面
            chatInterface.style.display = 'block';
            libraryContent.classList.remove('show');
            
            // 设置活动导航
            navItems.forEach(item => item.classList.remove('active'));
            document.querySelector('[data-page="chat"]').classList.add('active');
        }

        // 切换页面
        function switchPage(e) {
            const page = e.currentTarget.getAttribute('data-page');
            
            // 更新导航状态
            navItems.forEach(item => item.classList.remove('active'));
            e.currentTarget.classList.add('active');
            
            // 切换页面内容
            if (page === 'chat') {
                chatInterface.style.display = 'block';
                libraryContent.classList.remove('show');
            } else if (page === 'library') {
                chatInterface.style.display = 'none';
                libraryContent.classList.add('show');
                
                // 如果是从对话中切换过来，添加一条提示消息
                if (currentUserJourney.step !== 'welcome') {
                    addMessageToChat('你切换到了资料库。这里可以查看学习资料，比如刚才提到的"火锅"。', 'bot');
                }
            } else if (page === 'about') {
                chatInterface.style.display = 'none';
                libraryContent.classList.remove('show');
                
                // 显示关于页面内容
                if (libraryContent.querySelector('#aboutContent')) {
                    libraryContent.querySelector('#aboutContent').remove();
                }
                
                const aboutContent = document.createElement('div');
                aboutContent.id = 'aboutContent';
                aboutContent.innerHTML = `
                    <h2>关于 Mandarin Mate</h2>
                    <p>Mandarin Mate 是一个免费的普通话学习平台，帮助外国人和学习者通过沉浸式对话练习中文。</p>
                    <h3>我们的特点：</h3>
                    <ul>
                        <li>多种对话模式：按住说话、实时通话</li>
                        <li>个性化语伴：标准普通话导师、街头口语达人、商务专家、旅行助手</li>
                        <li>即时反馈：对话后生成详细报告</li>
                        <li>丰富的学习资料：文化、食物、旅游等内容</li>
                        <li>完全免费：无需注册即可使用</li>
                    </ul>
                `;
                libraryContent.appendChild(aboutContent);
                libraryContent.classList.add('show');
            }
        }

        // 显示发音指导
        function showPronunciationGuide() {
            addMessageToChat('发音指导：请大声朗读以下词语：<br><br><strong>你好 (nǐ hǎo)</strong> - 注意"你"的第三声和"好"的第三声<br><strong>谢谢 (xiè xie)</strong> - 注意"谢"的第四声和轻声"谢"<br><strong>中国 (zhōng guó)</strong> - 注意"中"的第一声和"国"的第二声', 'bot');
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initUserJourney);

        // 模拟一些初始交互
        setTimeout(() => {
            if (currentUserJourney.step === 'welcome') {
                // 欢迎屏幕上的提示
                console.log('欢迎使用 Mandarin Mate！点击"以游客身份开始"立即体验。');
            }
        }, 1000);
    </script>
</body>
</html>
